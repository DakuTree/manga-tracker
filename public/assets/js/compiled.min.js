$(function(){$('[data-toggle="tooltip"]').tooltip({html:!0})});$(function(){function e(c,f){f="undefined"!==typeof f?f:!1;$("#import-status").text(c).show().delay(4E3).fadeOut(1E3).attr("style",f?"color: rgb(0, 230 ,0)":"color: rgb(230, 0 ,0)")}function d(){k.scrollTop()>=l?(n.css("margin-top","97px"),m.addClass("fixed-header"),m.css("width",$("#list-nav").parent().width()+"px")):(n.css("margin-top","5px"),m.removeClass("fixed-header"),m.css("width","initial"))}if("dashboard"!==page)return!1;$(".tablesorter").tablesorter();$(".tracker-table").find("> tbody > tr > td:nth-of-type(1)").click(function(c){$(c.target).is("input")||
(c=$(this).find("> input[type=checkbox]"),$(c).prop("checked",!c.prop("checked")))});$(".update-read").click(function(){var c=this,f=$(this).closest("tr"),a=$(f).attr("data-id"),b=$(f).find(".current"),d=$(f).find(".latest");$.post(base_url+"ajax/update_inline",{id:a,chapter:d.attr("data-chapter")},function(){$(c).parent().find(".update-read, .ignore-latest").hide();$(b).attr("href",$(d).attr("href")).text($(d).text())}).fail(function(c,f,a){switch(c.status){case 400:alert("ERROR: "+a);break;case 429:alert("ERROR: Rate limit reached.");
break;default:alert("ERROR: Something went wrong!\n"+a)}})});$(".ignore-latest").click(function(){var c=this,f=$(this).closest("tr"),a=$(f).attr("data-id"),b=$(f).find(".current"),d=$(f).find(".latest");confirm("Ignore latest chapter?")&&$.post(base_url+"ajax/ignore_inline",{id:a,chapter:d.attr("data-chapter")},function(){$(c).parent().find(".update-read, .ignore-latest").hide();$(b).parent().append($("<span/>",{"class":"hidden-chapter",title:"This latest chapter was marked as ignored.",text:$(d).text()}))}).fail(function(c,
f,a){switch(c.status){case 400:alert("ERROR: "+a);break;case 429:alert("ERROR: Rate limit reached.");break;default:alert("ERROR: Something went wrong!\n"+a)}})});$("#delete_selected").click(function(c){c.preventDefault();c=$(".tracker-table:visible").find("tr:has(td input[type=checkbox]:checked)");0<c.length?(c=$(c).map(function(){return parseInt($(this).attr("data-id"))}).toArray(),confirm("Are you sure you want to delete the selected rows?")&&$.post(base_url+"ajax/delete_inline",{"id[]":c},function(){location.reload()}).fail(function(c,
a,b){switch(c.status){case 400:alert("ERROR: "+b);break;case 429:alert("ERROR: Rate limit reached.");break;default:alert("ERROR: Something went wrong!\n"+b)}})):alert("No selected series found.")});$("#file_import").change(function(){var c=this.files;if(c&&c[0])if(c=c[0],c.name.match(/\.json$/))if(2097152<c.size)e("ERROR: File too large ( < 2MB)!");else{var a=new FileReader;a.onload=function(c){c=c.target.result;var a;a:{try{JSON.parse(c)}catch(b){a=!1;break a}a=!0}a?(a=new FormData,a.append("json",
c),$.ajax({type:"POST",url:"./import_list",data:a,success:function(){e("Upload was a success! Reloading page.",!0);setTimeout(function(){location.reload()},2500)},error:function(c,a,b){switch(c.status){case 400:alert("ERROR: "+b);break;case 429:alert("ERROR: Rate limit reached.");break;default:alert("ERROR: Something went wrong!\n"+b)}},contentType:!1,processData:!1})):e("ERROR: File isn't valid JSON!")};a.readAsText(c)}else e("ERROR: Only .json is supported!")});$(".more-info").click(function(c){c.preventDefault();
$(this).find("+ .tags").toggle();"More info"===$(this).text()?$(this).text("Hide info"):$(this).text("More info")});$(".edit-tags").click(function(c){c.preventDefault();$(this).parent().find(".tag-edit").toggleClass("hidden")});$(".tag-edit input").on("keypress",function(){13===event.which&&$(this).closest(".tag-edit").find("[type=button]").click()});$(".tag-edit [type=button]").click(function(){var c=this,a=$(this).closest(".tag-edit").find("input"),b=a.val().trim().replace(/,,/g,","),d=$(this).closest("tr").attr("data-id");
if(/^[a-z0-9\-_,:]{0,255}$/.test(b)){var g=Array.from(new Set(b.split(","))).filter(function(c){return""!==c}),e=g.join(",");-1===$.inArray("none",g)?1>=(b.match(/\bmal:(?:[0-9]+|none)\b/g)||[]).length?$.post(base_url+"ajax/tag_update",{id:d,tag_string:e},function(){$(a).val(e);$(c).closest(".tags").find(".tag-list").text(e||"none");$(c).closest(".tag-edit").toggleClass("hidden")}).fail(function(c,a,b){switch(c.status){case 400:alert("ERROR: "+b);break;case 401:alert("Session has expired, please re-log to continue.");
break;case 429:alert("ERROR: Rate limit reached.");break;default:alert("ERROR: Something went wrong!\n"+b)}}):alert("You can only use one MAL ID tag per series"):alert('"none" is a restricted tag.')}else alert("Tags can only contain: lowercase a-z, 0-9, -, :, & _. They can also only have one MAL metatag.")});$("#search").on("input",function(){var c=$(this).val(),a=$(".tag-list"),b=a.filter(function(){var a=c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),a=new RegExp(a,"i");return!(a.test($(this).text())||
a.test($(this).closest("tr").find("> td:nth-of-type(2) > a").text()))}),a=$(a).not(b);b.closest("tr").addClass("hidden");a.closest("tr").removeClass("hidden")});$("#category-nav").find("> .nav > li > a").click(function(a){a.preventDefault();$(this).closest("ul").find("> .active").removeClass("active");$(this).parent().addClass("active");$(".tracker-table:visible").hide();$('.tracker-table[data-list="'+$(this).attr("data-list")+'"]').show()});$("#move-input").change(function(){var a=$(this).find(":selected");
if(a.is("[value]")){var b=$(".tracker-table:visible").find("tr:has(td input[type=checkbox]:checked)");0<b.length&&(b=$(b).map(function(){return parseInt($(this).attr("data-id"))}).toArray(),$.post(base_url+"ajax/set_category",{"id[]":b,category:a.attr("value")},function(){location.reload()}).fail(function(a,c,b){switch(a.status){case 400:alert("ERROR: "+b);break;case 429:alert("ERROR: Rate limit reached.");break;default:alert("ERROR: Something went wrong!\n"+b)}}))}});if("undefined"!==typeof use_live_countdown_timer&&
use_live_countdown_timer)var b=$("#update-timer"),a=b.text().split(":"),g=parseInt(3600*a[0],10)+parseInt(60*a[1],10)+parseInt(a[2],10),h=setInterval(function(){var a=parseInt(g/60/60,10).toString(),d=parseInt(g/60%60,10).toString(),e=parseInt(g%60,10).toString();1===a.length&&(a="0"+a);1===d.length&&(d="0"+d);1===e.length&&(e="0"+e);b.text(a+":"+d+":"+e);0>--g&&(clearInterval(h),setTimeout(function(){$("link[rel*='icon']").attr("href",base_url+"favicon.production.updated.ico")},6E4))},1E3);var k=
$(window),l=$("#category-nav").offset().top-$("#category-nav").find("> ul").height()-21,m=$("#list-nav"),n=$("table[data-list]");k.scroll(function(){d()});d();$("#update-notice").on("closed.bs.alert",function(){$.post(base_url+"ajax/hide_notice")})});$(function(){if("history"!==page)return!1;$(".pagination").pagination({currentPage:currentPagination,pages:totalPagination,displayedPages:10,hrefTextPrefix:/user\/history/.test(location.pathname)?"/user/history/":"/history/"+titleID+"/",selectOnClick:!1,prevText:"&laquo;",nextText:"&raquo;"})});$(function(){if("import_amr"!==page)return!1;var e="Manga-Fox;Batoto;Manga Here;MangaStream;Manga Panda;Kirei Cake;Dynasty Scans".split(";");$("#amr_import").change(function(){var d=this.files;if(d&&d[0])if(d=d[0],d.name.match(/\.(json|txt)$/))if(2097152<d.size)alert("ERROR: File too large ( < 2MB)!");else{var b=new FileReader;b.onload=function(a){a=a.target.result;var b;a:{try{JSON.parse(a)}catch(d){b=!1;break a}b=!0}if(b)if(a=JSON.parse(a),a.mangas){var h={};if(JSON.parse(a.mangas).every(function(a){return"mirror"in
a||"name"in a||"url"in a||"lastChapterReadURL"in a?(h[a.mirror]||(h[a.mirror]=[]),h[a.mirror].push(a),!0):!1})){a={};for(var k in h){b=h[k];var l=e.includes(k)?"#amr_good":"#amr_bad";"#amr_bad"===l&&$("#amr_bad").is(":empty")&&$("<h3/>",{text:"Incompatible Sites"}).appendTo("#amr_bad");$("<h4/>",{text:k+" ("+b.length+")"}).appendTo(l);a.tbody=$("<tbody/>",{"aria-live":"polite","aria-relevant":"all"});b.forEach(function(a){return function(b){$("<tr/>",{role:"row"}).append($("<td/>",{style:"width: 50%"}).append($("<a/>",
{href:b.url,text:b.name}))).append($("<td/>",{style:"width: 50%"}).append($("<a/>",{href:b.lastChapterReadURL,text:b.lastChapterReadName}))).appendTo(a.tbody)}}(a));$("<table/>",{"class":"tablesorter tablesorter-bootstrap table-striped",role:"grid"}).append(a.tbody).appendTo(l);a={tbody:a.tbody}}}else alert("JSON has invalid keys?")}else alert('JSON file is missing "mangas" object. Was this exported from AMR?');else alert("ERROR: File isn't valid JSON!")};b.readAsText(d)}else alert("ERROR: Only .json/txt is supported!")})});$(function(){if("index"!==page)return!1;$(".example-image").hover(function(){$(this).attr("src",function(e,d){return d.replace(/.png$/,".gif")})},function(){$(this).attr("src",function(e,d){return d.replace(/.gif$/,".png")})})});$(function(){if("login"!==page)return!1;$(".button-checkbox").each(function(){function e(){var d=a.is(":checked");b.data("state",d?"on":"off");b.find(".state-icon").removeClass().addClass("state-icon "+h[b.data("state")].icon);d?b.removeClass("btn-default").addClass("btn-"+g+" active"):b.removeClass("btn-"+g+" active").addClass("btn-default")}var d=$(this),b=d.find("button"),a=d.find("input:checkbox"),g=b.data("color"),h={on:{icon:"glyphicon glyphicon-check"},off:{icon:"glyphicon glyphicon-unchecked"}};
b.on("click",function(){a.prop("checked",!a.is(":checked"));a.triggerHandler("change");e()});a.on("change",function(){e()});e();0===b.find(".state-icon").length&&b.prepend('<i class="state-icon '+h[b.data("state")].icon+'"></i>\u00a0')})});$(function(){if("options"!==page)return!1;$("input[type=checkbox][name^=category_custom]").change(function(){"1"===$(this).data("has-series")&&(alert("Unable to disable category while it still contains series."),$(this).prop("checked",!$(this).prop("checked")))});$("input[type=text][name^=category_custom]").click(function(){$(this).parent().find("[type=checkbox]").attr("checked",!0)})});$(function(){if("signup"!==page)return!1;$("#page[data-page=signup]").find("form").validate({ignore:[],onkeyup:!1,rules:{username:{minlength:4,maxlength:15,pattern:/^[a-zA-Z0-9_-]{4,15}$/,remote:{url:base_url+"ajax/username_check",type:"post",data:{username:function(){return $("input[name='username']").val()}}}}},messages:{username:{minlength:"This username is too short (Minimum 4 characters).",maxlength:"This username is too long (Maximum 15 characters).",pattern:"This username has invalid characters (Only allowed a-z, A-Z, 0-9, _ & - characters).",
remote:"This username already taken."}}});$(".button-checkbox").each(function(){function e(){var d=a.is(":checked");b.data("state",d?"on":"off");b.find(".state-icon").removeClass().addClass("state-icon "+h[b.data("state")].icon);d?b.removeClass("btn-default").addClass("btn-"+g+" active"):b.removeClass("btn-"+g+" active").addClass("btn-default")}var d=$(this),b=d.find("button"),a=d.find("input:checkbox"),g=b.data("color"),h={on:{icon:"glyphicon glyphicon-check"},off:{icon:"glyphicon glyphicon-unchecked"}};
b.on("click",function(){a.prop("checked",!a.is(":checked"));a.triggerHandler("change");e()});a.on("change",function(){e()});e();0===b.find(".state-icon").length&&b.prepend('<i class="state-icon '+h[b.data("state")].icon+'"></i>')})});
